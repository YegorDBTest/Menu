{% extends "main_app/base.html" %}

{% block title %}Меню{% endblock %}

{% block head %}{% endblock %}

{% block tail %}
  <script type="text/javascript">
    var createDishUrl = "{% url 'create-dish' %}";
    $(document).ready(function() {
      getDishes({
        ids: null,
        totalNeeded: false,
        checkboxNeeded: true
      });

      $('#dishForm').submit(function(e) {
        e.preventDefault();

        var data = new FormData(this);
        $.ajax({
          url: createDishUrl,
          data: data,
          type: "POST",
          processData: false,
          contentType: false,
        })
        .done(function(dish) {
          drawDish(dish, true, 'prepend');
          $('#dishFormModal').modal('hide');
        })
        .fail(function() {
          alert("Ошибка при сохранении данных");
        });
      });

      $('body').delegate('.dish-checkbox', 'change', function(e) {
        let dishesIds = [];
        for (let checkbox of $('.dish-checkbox:checked')) {
          dishesIds.push($(checkbox).attr('dish-id'));
        }
        document.cookie = `order-dishes=${dishesIds.join()}`;
      });
    });
  </script>
{% endblock %}

{% block content %}
  {% include "main_app/header.html" with page_kind="index" %}

  <div class="container">
    {% for category in categories %}
      <div>
        <h2>{{ category.name }}</h2>
        <div class="row" id="category{{ category.id }}-items">
        </div>
      </div>
      <hr>
    {% endfor %}
  </div>
{% endblock %}
